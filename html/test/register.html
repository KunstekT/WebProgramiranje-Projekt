<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Create account</title>
        <script>
            let myUser;

            function User(name, dateOfBirth, email, password) {
                this.accountName = name;
                this.dateOfBirth = dateOfBirth;
                this.email = email;
                this.password = password;
            }                       

            function createUser() {
                let name = document.getElementById("aname").value;
                let dateOfBirth = document.getElementById("birthday").value;
                let password1 = document.getElementById("pass").value;
                let password2 = document.getElementById("2ndpass").value;
                let email = document.getElementById("email").value;
                if(email != '' && password1 != '' && password2 != '' && name != ''){
                    if(checkAccName(name)){
                        if(checkMail(email)){
                            if(checkPass(password1)){
                                if(password1 == password2){
                                    if(checkAge(dateOfBirth)){
                                        myUser = new User(name, dateOfBirth, email, password1);
                                    }
                                    else
                                    {
                                        alert("You must be 18 or older to register!");
                                    } 
                                }
                                else
                                {
                                    alert("Passwords must match!");
                                }    
                            }
                            else
                            {
                                alert("Password needs to be at least 8 characters long!");
                            } 
                        }
                        else
                        {
                            alert("Email incorrect or already in use!");
                        }                     
                    }
                    else
                    {
                        alert("Account name needs to be at least 6 characters long!");
                    }  
                }
                else{
                    alert("All fields must be filled!");
                }                           
            }

            function printUser() {
                alert("" + myUser.accountName + ", " + myUser.dateOfBirth + ", " + myUser.email + ", " + myUser.password);
            }

            function checkPass(pass){
                if(pass.toString().length>=8)
                {
                    return true;       
                }
                else
                    return false
            }

            function checkAccName(name){
                if(name.toString().length>=6)
                {
                    return true;       
                }
                else
                    return false
            }

            function checkMail(mail){
                if(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail))
                {
                    return true;       
                }
                else
                    return false
            }

            function checkAge(dateOfBirth){
                let todayDate = new Date();
                console.log(todayDate);
                var birthDate = new Date(dateOfBirth.toString());
                console.log(dateOfBirth);
                var age = todayDate.getFullYear() - birthDate.getFullYear();
                var month = todayDate.getMonth() - birthDate.getMonth();
                if (month < 0 || (month === 0 && todayDate.getDate() < birthDate.getDate())) 
                {
                    age--; 
                    console.log(age);     
                }
                if(age>=18)
                {                    
                    return true; 
                }
                else
                    return false
            }
        </script>
    </head>
    <body>
        <form>
            <p>
                <label for="aname">Account Name: </label>
                <input type="text" name="aname" id="aname">
            </p>
            <p>
                <label for="email">Email: </label>
                <input type="text" name="email" id="email">
            </p>
            <p>
                <label for="pass">Password: </label>
                <input type="text" name="pass" id="pass">
            </p>
            <p>
                <label for="2ndpass">Repeat Password: </label>
                <input type="text" name="2ndpass" id="2ndpass">
            </p>
            <p>
                <label>Date of birth:</label>
                <input type="date" id="birthday" name="birthday">
            </p>
        </form>
        <p>
            <button type="button" onclick="createUser()">Kreiranje korisnika</button>
        </p>
        <p>
            <button type="button" onclick="printUser()">Ispis podataka korisnika</button>
        </p>
    </body>
</html>